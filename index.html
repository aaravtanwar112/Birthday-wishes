<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday — A Little Gift</title>
<style>
  :root{
    --bg:#0b1020;
    --card-bg: rgba(255,255,255,0.06);
    --accent: #ff7ab6;
    --text:#fff;
    --glass: rgba(255,255,255,0.04);
  }
  html,body{height:100%;margin:0;font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;background:linear-gradient(180deg,#071022,#0b1330);}
  .page{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
    color:var(--text);
  }

  /* background image layer */
  .bg{
    position:absolute;inset:0;background-size:cover;background-position:center;filter:brightness(.55) saturate(1.05);
    z-index:0;
  }

  /* subtle overlay */
  .overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(3,8,20,0.35), rgba(2,6,12,0.6));z-index:1}

  .container{
    position:relative;z-index:5;width:min(1100px,95%);display:grid;grid-template-columns:1fr 360px;gap:24px;padding:28px;
  }

  /* hero card */
  .card{
    background:var(--card-bg);border-radius:14px;padding:28px;box-shadow:0 10px 30px rgba(2,8,20,0.6);min-height:460px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;
  }

  .title{
    font-size:48px;line-height:1.05;text-align:center;margin:0 0 8px;font-weight:700;letter-spacing: -0.02em;
  }
  .subtitle{font-size:18px;opacity:.9;margin-bottom:16px;text-align:center}
  .main-text{font-size:30px;text-align:center;white-space:pre-line;margin:8px 0 18px;font-weight:600}

  /* book / card reveal */
  .reveal{
    margin-top:12px;
    display:flex;gap:12px;align-items:center;
  }

  button.btn{
    background:linear-gradient(90deg,var(--accent), #ffb3e0);
    border:none;padding:10px 16px;border-radius:10px;color:#081021;font-weight:700;cursor:pointer;font-size:15px;
  }
  button.ghost{
    background:transparent;border:1px solid rgba(255,255,255,0.08);padding:10px 14px;border-radius:10px;color:var(--text);cursor:pointer;
  }

  /* right panel (settings) */
  .panel{
    background:var(--glass);border-radius:12px;padding:18px;color:var(--text);min-height:360px;
    position:relative;
  }
  .panel h3{margin:0 0 10px;font-size:18px}
  .row{display:flex;gap:8px;align-items:center;margin:8px 0}
  label{font-size:13px;opacity:.9}
  input[type="text"], select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);outline:none}
  input[type="color"]{padding:0;border:none;background:transparent;cursor:pointer}

  /* small toggles */
  .toggle{display:inline-flex;align-items:center;gap:8px}
  .small{font-size:13px;color:#dfe7ff;opacity:.9}

  /* falling text rain */
  .rain-layer{pointer-events:none;position:absolute;inset:0;z-index:3;overflow:hidden}
  .drop{position:absolute;top:-120px;white-space:nowrap;font-weight:700;font-size:20px;opacity:.9;filter:drop-shadow(0 6px 12px rgba(0,0,0,0.45));transform:translateY(-10px) rotate(0);}
  @keyframes fall {
    to { transform:translateY(120vh) rotate(10deg); opacity:0.9; }
  }

  /* hearts */
  .hearts{position:absolute;inset:0;pointer-events:none;z-index:4}
  .heart{position:absolute;width:26px;height:26px;background:transparent;opacity:0.9;transform:translate3d(0,0,0) scale(1);animation:rise 6s linear infinite}
  .heart::before,.heart::after{content:"";position:absolute;width:26px;height:26px;border-radius:50%;background:var(--accent)}
  .heart::before{left:13px}
  .heart::after{top: -13px}
  @keyframes rise {
    0%{transform: translateY(20vh) scale(.6); opacity:0}
    10%{opacity:1}
    100%{transform: translateY(-150vh) scale(1.2); opacity:0}
  }

  /* small footer */
  .footer{position:relative;text-align:center;padding-top:16px;color:rgba(255,255,255,0.6);font-size:13px}

  /* responsive */
  @media (max-width:880px){
    .container{grid-template-columns:1fr;gap:14px}
    .title{font-size:36px}
    .main-text{font-size:22px}
  }
</style>
</head>
<body>
<div class="page">
  <div class="bg" id="bg" style="background-image:url('https://images.unsplash.com/photo-1564869736136-1c0c4bdb9d7d?q=80&w=1600&auto=format&fit=crop');"></div>
  <div class="overlay"></div>

  <div class="container">
    <div class="card" id="card">
      <div class="rain-layer" id="rain"></div>
      <div class="hearts" id="hearts"></div>

      <h1 class="title" id="title">Happy Birthday!</h1>
      <div class="subtitle" id="subtitle">A tiny surprise made just for you</div>

      <div class="main-text" id="mainText">
        To the one who brightens every day | Wishing you the happiest birthday and a year full of love.
      </div>

      <div class="reveal">
        <button class="btn" id="openBtn">Open Gift</button>
        <button class="ghost" id="playBtn">Play Music ▶</button>
        <div style="width:14px"></div>
        <div id="countdown" class="small" style="align-self:center">Will reveal in: <span id="timer">—</span></div>
      </div>

      <div class="footer">Made with ♥ — Customize the message & effects from the settings panel.</div>
    </div>

    <aside class="panel" aria-label="settings">
      <h3>Settings</h3>

      <div class="row">
        <label style="flex:1">
          Main message (use <code>|</code> to split lines)
          <input type="text" id="inputMessage" value="To the one who brightens every day | Wishing you the happiest birthday and a year full of love.">
        </label>
      </div>

      <div class="row">
        <label style="flex:1">
          Background image URL
          <input type="text" id="inputBg" value="https://images.unsplash.com/photo-1564869736136-1c0c4bdb9d7d?q=80&w=1600&auto=format&fit=crop">
        </label>
      </div>

      <div class="row">
        <label style="flex:1">
          Background song URL (mp3)
          <input type="text" id="inputSong" value="">
        </label>
      </div>

      <div class="row">
        <label style="flex:1">
          Countdown before reveal (seconds)
          <select id="inputDelay">
            <option value="0">0 (instant)</option>
            <option value="3">3</option>
            <option value="5" selected>5</option>
            <option value="10">10</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label style="flex:1">
          Rain text (comma separated phrases)
          <input type="text" id="inputRain" value="Happy,Love,✨,HBD,MakeAWish">
        </label>
      </div>

      <div class="row">
        <label class="toggle"><input type="checkbox" id="toggleRain" checked> <span class="small">Enable text rain</span></label>
      </div>

      <div class="row">
        <label class="toggle"><input type="checkbox" id="toggleHearts" checked> <span class="small">Enable hearts</span></label>
      </div>

      <div class="row">
        <label class="toggle">Text color <input type="color" id="textColor" value="#ffffff"></label>
      </div>

      <div class="row">
        <button class="btn" id="applyBtn">Apply Settings</button>
        <button class="ghost" id="resetBtn">Reset</button>
      </div>

      <div style="margin-top:10px;font-size:13px;color:rgba(255,255,255,0.7)">
        Tip: Change the message, click Apply, then press "Open Gift".
      </div>
    </aside>
  </div>
</div>

<!-- audio element (hidden) -->
<audio id="audio" loop crossorigin="anonymous"></audio>

<script>
  // elements
  const inputMessage = document.getElementById('inputMessage');
  const inputBg = document.getElementById('inputBg');
  const inputSong = document.getElementById('inputSong');
  const inputDelay = document.getElementById('inputDelay');
  const inputRain = document.getElementById('inputRain');
  const toggleRain = document.getElementById('toggleRain');
  const toggleHearts = document.getElementById('toggleHearts');
  const textColor = document.getElementById('textColor');

  const title = document.getElementById('title');
  const subtitle = document.getElementById('subtitle');
  const mainText = document.getElementById('mainText');
  const bg = document.getElementById('bg');
  const rainLayer = document.getElementById('rain');
  const heartsLayer = document.getElementById('hearts');
  const applyBtn = document.getElementById('applyBtn');
  const resetBtn = document.getElementById('resetBtn');
  const openBtn = document.getElementById('openBtn');
  const playBtn = document.getElementById('playBtn');
  const audio = document.getElementById('audio');
  const countdownEl = document.getElementById('timer');

  // defaults
  const defaultState = {
    message: inputMessage.value,
    bg: inputBg.value,
    song: inputSong.value,
    delay: Number(inputDelay.value),
    rain: inputRain.value,
    rainOn: toggleRain.checked,
    heartsOn: toggleHearts.checked,
    color: textColor.value
  };

  // helper: set visible message and split by '|'
  function setMessage(msg){
    // allow '|' as separator for lines
    const parts = msg.split('|').map(s => s.trim());
    mainText.innerHTML = parts.map(p => `<div>${escapeHtml(p)}</div>`).join('');
  }

  function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // apply settings
  function applySettings(fromLoad=false){
    const state = {
      message: inputMessage.value || defaultState.message,
      bgUrl: inputBg.value || defaultState.bg,
      song: inputSong.value.trim(),
      delay: Number(inputDelay.value)||0,
      rainStr: inputRain.value || '',
      rainOn: toggleRain.checked,
      heartsOn: toggleHearts.checked,
      color: textColor.value || '#ffffff'
    };
    // message
    setMessage(state.message);
    title.style.color = state.color;
    mainText.style.color = state.color;
    subtitle.style.color = state.color;

    // background
    bg.style.backgroundImage = `url('${state.bgUrl}')`;

    // audio
    if(state.song){
      audio.src = state.song;
      // don't auto-play silently; wait for user activation
    } else {
      audio.removeAttribute('src');
      audio.pause();
      playBtn.textContent = 'Play Music ▶';
    }

    // rain
    if(state.rainOn && state.rainStr.trim()){
      makeRain(state.rainStr.split(',').map(s=>s.trim()).filter(Boolean));
    } else {
      rainLayer.innerHTML = '';
    }

    // hearts
    if(state.heartsOn){
      makeHearts();
    } else {
      heartsLayer.innerHTML = '';
    }

    // show countdown if not fromLoad (on load we will not auto-run)
    if(!fromLoad){
      showCountdown(state.delay);
    }
  }

  // countdown reveal logic
  let countdownTimer = null;
  function showCountdown(sec){
    if(countdownTimer) { clearInterval(countdownTimer); countdownTimer = null; }
    if(sec <= 0){
      countdownEl.textContent = 'now';
      // no delay
      return;
    }
    let left = sec;
    countdownEl.textContent = left + 's';
    countdownTimer = setInterval(()=> {
      left--;
      if(left <= 0){
        clearInterval(countdownTimer);
        countdownEl.textContent = 'now';
      } else {
        countdownEl.textContent = left + 's';
      }
    },1000);
  }

  // Open gift behavior: reveal animation (we'll just pulse and scroll into view)
  openBtn.addEventListener('click', async () => {
    const delay = Number(inputDelay.value) || 0;
    // if there's a delay, set countdown and await it
    if(delay > 0){
      // Show countdown instantly and wait
      showCountdown(delay);
      await new Promise(res => setTimeout(res, delay*1000));
    }
    // small reveal animation
    cardPulse();
    // attempt to play audio automatically if source present (must be user gesture)
    if(audio.src && audio.paused){
      try { await audio.play(); playBtn.textContent = 'Pause ⏸'; } catch(e){}
    }
  });

  // play/pause button
  playBtn.addEventListener('click', async () => {
    if(!audio.src){
      // attempt to use a gentle built-in sample if none provided
      audio.src = 'https://cdn.pixabay.com/download/audio/2023/03/09/audio_9c1f9e9e05.mp3?filename=happy-birthday-on-piano-6971.mp3';
    }
    if(audio.paused){
      try { await audio.play(); playBtn.textContent = 'Pause ⏸'; }
      catch(e) { alert('Playback blocked — try clicking Open Gift first or allow audio playback.'); }
    } else {
      audio.pause(); playBtn.textContent = 'Play Music ▶';
    }
  });

  // simple pulse reveal on card
  function cardPulse(){
    const c = document.getElementById('card');
    c.animate([
      { transform: 'scale(1)', boxShadow: '0 8px 30px rgba(0,0,0,0.5)' },
      { transform: 'scale(1.02)', boxShadow: '0 18px 40px rgba(0,0,0,0.6)' },
      { transform: 'scale(1)', boxShadow: '0 8px 30px rgba(0,0,0,0.5)' }
    ], { duration: 700, easing: 'ease-out' });
  }

  // make rain
  function makeRain(phrases){
    rainLayer.innerHTML = '';
    const w = window.innerWidth;
    const count = Math.min(30, Math.floor(w/40));
    for(let i=0;i<count;i++){
      const p = phrases[Math.floor(Math.random()*phrases.length)];
      const span = document.createElement('div');
      span.className = 'drop';
      span.textContent = p;
      const left = Math.random()*100;
      const size = 14 + Math.random()*22;
      span.style.left = left + 'vw';
      span.style.fontSize = size + 'px';
      span.style.color = randomPastel();
      const delay = Math.random()*-10;
      const dur = 6 + Math.random()*6;
      span.style.animation = `fall ${dur}s linear ${delay}s infinite`;
      rainLayer.appendChild(span);
    }
  }

  function randomPastel(){
    // pick pastel-ish color
    const h = Math.floor(Math.random()*360);
    const s = 80; const l = 70;
    return `hsl(${h} ${s}% ${l}%)`;
  }

  // make hearts
  function makeHearts(){
    heartsLayer.innerHTML = '';
    const count = 10;
    for(let i=0;i<count;i++){
      const el = document.createElement('i');
      el.className = 'heart';
      const left = Math.random()*100;
      const size = 14 + Math.random()*26;
      el.style.left = left + 'vw';
      el.style.bottom = (-Math.random()*20) + 'vh';
      el.style.width = size + 'px'; el.style.height = size + 'px';
      el.style.opacity = (0.6 + Math.random()*0.5).toFixed(2);
      el.style.animationDuration = (5 + Math.random()*6) + 's';
      heartsLayer.appendChild(el);
    }
  }

  // helpers: apply button
  applyBtn.addEventListener('click', ()=> applySettings());
  resetBtn.addEventListener('click', ()=> {
    inputMessage.value = defaultState.message;
    inputBg.value = defaultState.bg;
    inputSong.value = defaultState.song;
    inputDelay.value = defaultState.delay;
    inputRain.value = defaultState.rain;
    toggleRain.checked = defaultState.rainOn;
    toggleHearts.checked = defaultState.heartsOn;
    textColor.value = defaultState.color;
    applySettings();
  });

  // initialize
  applySettings(true);

  // accessibility: allow Enter in message to apply
  inputMessage.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ applySettings(); } });

  // update layout on resize
  
  window.addEventListener('resize', ()=> {
    if(toggleRain.checked && inputRain.value.trim()){
      makeRain(inputRain.value.split(',').map(s=>s.trim()).filter(Boolean));
    }
  });
</script>
</body>
</html>
